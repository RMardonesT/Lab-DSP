/***************************************************************************//**
* \file     Funciones que deben impementar los alumnos
*
* \brief    Plantilla para crear funci�n en C para una sFunction de Matlab
*
* \authors  Gonzalo Carrasco
*******************************************************************************/

/******************************************************************************
**      HEADER FILES
******************************************************************************/
#include <template.h>
#include <stdint.h>
#include <stdbool.h>

/******************************************************************************
**      MODULE PREPROCESSOR CONSTANTS
******************************************************************************/
#define N 320  // Ts = 1/16kps = 62 us -> n = 20ms/62us = 320

/******************************************************************************
**      MODULE MACROS
******************************************************************************/


/******************************************************************************
**      MODULE DATATYPES
******************************************************************************/


/******************************************************************************
**      MODULE VARIABLE DEFINITIONS
******************************************************************************/


/******************************************************************************
**      PRIVATE FUNCTION DECLARATIONS (PROTOTYPES)
******************************************************************************/


/******************************************************************************
**      FUNCTION DEFINITIONS
******************************************************************************/

/***************************************************************************//**
*   \brief Implementaci�n de linea de retardo mediante buffer lineal
*
*   \param  input : Arreglo de datos de la se�al
*	\param  n     : Muestras del Retardo
*
*   \return Void.
*******************************************************************************/


double rms_20ms(double input) {

	static double buffer = 0;
	static unsigned int cont = 0;
	static double output = 0;

	buffer = buffer + pow(input,2); //eleva la muestra al cuadrado y la guarda en la sumatoria

	if (cont >= N)    //reinicia el buffer y entrega el rms acumulado hasta ese momento
	{
		buffer = buffer/N;  //
		output = sqrt(buffer);
		buffer = 0;
		cont = 0;
	}
	else
		{
			cont ++;
		}


	return output;
}








/******************************************************************************
**      END OF SOURCE FILE
******************************************************************************/
